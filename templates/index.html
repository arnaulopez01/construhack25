<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visor Urbanismo AI</title>
    <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>

    <header class="app-header">
        <div class="header-logo">
            <i class="fa-solid fa-map-location-dot"></i> 
            <span>Visor Urbanismo <small>beta</small></span>
        </div>
        
        <div class="gemini-search-container">
            <div class="search-wrapper">
                <i class="fa-brands fa-google search-icon" title="Powered by Gemini"></i>
                <input type="text" id="gemini-prompt" placeholder="Pregunta a Gemini Flash 2.5 sobre la zona...">
                <button id="btn-send-prompt"><i class="fa-solid fa-paper-plane"></i></button>
            </div>
        </div>

        <div class="header-actions">
            <button class="icon-btn"><i class="fa-solid fa-gear"></i></button>
        </div>
    </header>

    <div id="map">
        
        <div class="map-buttons">
            <button id="layers-toggle" title="Gestionar Capas"><i class="fa-solid fa-layer-group"></i></button>
            <button id="toggle-3d" title="Alternar Vista 2D/3D"><i class="fa-solid fa-cube"></i></button>
            <button id="camera-button" title="Generar Foto"><i class="fa-solid fa-camera"></i></button>
        </div>

        <div id="layers-panel">
            <h4>Mapa Base</h4>
            <label class="layer-option"><input type="radio" name="base-layer" value="osm" checked> OSM</label>
            <label class="layer-option"><input type="radio" name="base-layer" value="esri-satellite"> Satélite</label>
            <label class="layer-option"><input type="radio" name="base-layer" value="esri-topo"> Topográfico</label>
            <hr>
            <h4>Capas Temáticas</h4>
            <label class="layer-option"><input type="checkbox" id="buildings-checkbox"> Edificios (3D)</label>
            <label class="layer-option"><input type="checkbox" id="population-points-checkbox"> Población (Puntos)</label>
            <label class="layer-option"><input type="checkbox" id="population-heatmap-checkbox"> Población (Calor)</label>
            <hr>
            <h4>Sensores IoT</h4>
            <label class="layer-option"><input type="checkbox" id="iot-checkbox"> Calidad Aire (Semáforo)</label>
            <hr>
            <h4>Urbanismo</h4>
            <label class="layer-option"><input type="checkbox" id="obras-checkbox"> Obras en Curso</label>
            <hr>
            <h4>Entorno</h4>
            <label class="layer-option"><input type="checkbox" id="terrain-3d-checkbox"> Relieve 3D (DTM)</label>
            <label class="layer-option"><input type="checkbox" id="catastro-checkbox"> Catastro (WMS)</label>
        </div>

        <div id="building-legend" class="map-overlay legend" style="display: none;">
            <h4>Uso del Edificio</h4>
            <div id="legend-content"></div>
        </div>

        <div id="iot-legend" class="map-overlay legend-iot" style="display: none;">
            <h4>Calidad del Aire</h4>
            <div id="iot-legend-content"></div>
        </div>

        <div id="heatmap-controls" class="map-overlay controls" style="display: none;">
            <h4>Control de Población</h4>
            <div class="slider-group">
                <label>Radio</label>
                <input type="range" id="heatmap-radius" min="5" max="50" step="1" value="20">
            </div>
            <div class="slider-group">
                <label>Intensidad</label>
                <input type="range" id="heatmap-intensity" min="0.1" max="3" step="0.1" value="1">
            </div>
        </div>

    </div>

    <div id="chat-overlay" class="chat-overlay" style="display: none;">
        <div class="chat-header">
            <span><i class="fa-solid fa-robot"></i> Respuesta Gemini</span>

            <button id="close-chat" onclick="document.getElementById('chat-overlay').style.display='none'">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>
        <div id="chat-content" class="chat-content">
        </div>
    </div>

    <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.9.0/proj4.js"></script>

    <script>
        const CONFIG = {
            lat: {{ start_lat }},
            lon: {{ start_lon }},
            zoom: {{ start_zoom }},
            maptilerKey: "{{ maptiler_api_key }}"
        };
    </script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>

</body>
</html>